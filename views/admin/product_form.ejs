<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h1 class="h4 text-gold mb-1"><%= product ? 'Editar produto' : 'Novo produto' %></h1>
    <p class="small text-muted mb-0">
      Preencha as informações do item que será exibido no catálogo.
    </p>
  </div>
  <a href="/admin/produtos" class="btn btn-outline-gold btn-sm">Voltar</a>
</div>

<form
  method="post"
  action="<%= product ? '/admin/produtos/' + product.id + '/editar' : '/admin/produtos/novo' %>"
  class="row g-3"
>
  <div class="col-12 col-md-6">
    <label for="name" class="form-label">Nome do produto</label>
    <input
      type="text"
      id="name"
      name="name"
      class="form-control bg-dark text-light border-gold"
      value="<%= product ? product.name : '' %>"
      required
    />
  </div>

  <div class="col-12 col-md-3">
    <label for="price" class="form-label">Preço (R$)</label>
    <input
      type="number"
      step="0.01"
      min="0"
      id="price"
      name="price"
      class="form-control bg-dark text-light border-gold"
      value="<%= product && product.price != null ? product.price : '' %>"
    />
  </div>

  <div class="col-12 col-md-3">
    <label for="category_id" class="form-label">Categoria</label>
    <select
      id="category_id"
      name="category_id"
      class="form-select bg-dark text-light border-gold"
    >
      <option value="">Sem categoria</option>
      <% categories.forEach(function (c) { %>
        <option
          value="<%= c.id %>"
          <%= product && product.category_id === c.id ? 'selected' : '' %>
        >
          <%= c.name %>
        </option>
      <% }) %>
    </select>
  </div>

  <div class="col-12">
    <label for="image_url" class="form-label">URL da imagem</label>
    <input
      type="url"
      id="image_url"
      name="image_url"
      class="form-control bg-dark text-light border-gold"
      placeholder="https://exemplo.com/imagem.jpg"
      value="<%= product ? product.image_url || '' : '' %>"
      oninput="previewImage(this.value)"
    />
    <div class="form-text text-muted mb-2">
      <strong>Como obter a URL da imagem:</strong>
      <ul class="small mb-0 mt-1">
        <li><strong>Instagram:</strong> Clique com botão direito na foto → "Copiar endereço da imagem"</li>
        <li><strong>Google Drive:</strong> Compartilhe a imagem como "Qualquer pessoa com o link" → Copie o link e substitua <code>/view</code> por <code>/uc?export=view&id=</code></li>
        <li><strong>Imgur/Outros:</strong> Faça upload e copie o link direto da imagem (deve terminar em .jpg, .png, etc.)</li>
      </ul>
    </div>
    <div id="imagePreview" class="mt-3" style="display: none;">
      <label class="form-label small">Pré-visualização:</label>
      <div class="border border-gold rounded p-2 bg-dark d-inline-block">
        <img id="previewImg" src="" alt="Preview" style="max-width: 200px; max-height: 200px; object-fit: contain;" class="img-fluid" />
      </div>
    </div>
  </div>

  <div class="col-12">
    <label for="description" class="form-label">Descrição do produto</label>
    <textarea
      id="description"
      name="description"
      rows="4"
      class="form-control bg-dark text-light border-gold"
      placeholder="Descreva o produto, suas características, materiais, cores disponíveis, etc."
    ><%= product ? product.description || '' : '' %></textarea>
    <div class="form-text text-muted">
      Esta descrição aparecerá no catálogo público. Seja detalhado para atrair mais clientes!
    </div>
  </div>

  <div class="col-12 d-flex justify-content-end">
    <button type="submit" class="btn btn-gold">
      <%= product ? 'Atualizar produto' : 'Adicionar produto' %>
    </button>
  </div>
</form>

<script>
  function previewImage(url) {
    const previewDiv = document.getElementById('imagePreview');
    const previewImg = document.getElementById('previewImg');
    
    if (url && url.trim() !== '') {
      previewImg.src = url;
      previewImg.onload = function() {
        previewDiv.style.display = 'block';
      };
      previewImg.onerror = function() {
        previewDiv.style.display = 'none';
      };
    } else {
      previewDiv.style.display = 'none';
    }
  }
  
  // Carregar preview se já houver imagem ao editar
  <% if (product && product.image_url) { %>
    window.addEventListener('DOMContentLoaded', function() {
      previewImage('<%= product.image_url %>');
    });
  <% } %>
</script>


